(function(e){var t,n,r,s,o,u,a,f,l,c,h;n=!!document.createElement("canvas").getContext;t=function(){var e=document.createElement("div");e.innerHTML='<v:shape id="vml_flag1" adj="1" />';var t=e.firstChild;t.style.behavior="url(#default#VML)";return t?typeof t.adj=="object":true}();if(!(n||t)){e.fn.maphilight=function(){return this};return}if(n){f=function(e){return Math.max(0,Math.min(parseInt(e,16),255))};l=function(e,t){return"rgba("+f(e.substr(0,2))+","+f(e.substr(2,2))+","+f(e.substr(4,2))+","+t+")"};r=function(t){var n=e('<canvas style="width:'+t.width+"px;height:"+t.height+'px;"></canvas>').get(0);n.getContext("2d").clearRect(0,0,n.width,n.height);return n};var p=function(e,t,n,r,s){r=r||0;s=s||0;e.beginPath();if(t=="rect"){e.rect(n[0]+r,n[1]+s,n[2]-n[0],n[3]-n[1])}else if(t=="poly"){e.moveTo(n[0]+r,n[1]+s);for(i=2;i<n.length;i+=2){e.lineTo(n[i]+r,n[i+1]+s)}}else if(t=="circ"){e.arc(n[0]+r,n[1]+s,n[2],0,Math.PI*2,false)}e.closePath()};s=function(t,n,r,i,s){var o,u=t.getContext("2d");if(i.shadow){u.save();if(i.shadowPosition=="inside"){p(u,n,r);u.clip()}var a=t.width*100;var f=t.height*100;p(u,n,r,a,f);u.shadowOffsetX=i.shadowX-a;u.shadowOffsetY=i.shadowY-f;u.shadowBlur=i.shadowRadius;u.shadowColor=l(i.shadowColor,i.shadowOpacity);var c=i.shadowFrom;if(!c){if(i.shadowPosition=="outside"){c="fill"}else{c="stroke"}}if(c=="stroke"){u.strokeStyle="rgba(0,0,0,1)";u.stroke()}else if(c=="fill"){u.fillStyle="rgba(0,0,0,1)";u.fill()}u.restore();if(i.shadowPosition=="outside"){u.save();p(u,n,r);u.globalCompositeOperation="destination-out";u.fillStyle="rgba(0,0,0,1);";u.fill();u.restore()}}u.save();p(u,n,r);if(i.fill){u.fillStyle=l(i.fillColor,i.fillOpacity);u.fill()}if(i.stroke){u.strokeStyle=l(i.strokeColor,i.strokeOpacity);u.lineWidth=i.strokeWidth;u.stroke()}u.restore();if(i.fade){e(t).css("opacity",0).animate({opacity:1},100)}};o=function(e){e.getContext("2d").clearRect(0,0,e.width,e.height)}}else{r=function(t){return e('<var style="zoom:1;overflow:hidden;display:block;width:'+t.width+"px;height:"+t.height+'px;"></var>').get(0)};s=function(t,n,r,i,s){var o,u,a,f;for(var l in r){r[l]=parseInt(r[l],10)}o='<v:fill color="#'+i.fillColor+'" opacity="'+(i.fill?i.fillOpacity:0)+'" />';u=i.stroke?'strokeweight="'+i.strokeWidth+'" stroked="t" strokecolor="#'+i.strokeColor+'"':'stroked="f"';a='<v:stroke opacity="'+i.strokeOpacity+'"/>';if(n=="rect"){f=e('<v:rect name="'+s+'" filled="t" '+u+' style="zoom:1;margin:0;padding:0;display:block;position:absolute;left:'+r[0]+"px;top:"+r[1]+"px;width:"+(r[2]-r[0])+"px;height:"+(r[3]-r[1])+'px;"></v:rect>')}else if(n=="poly"){f=e('<v:shape name="'+s+'" filled="t" '+u+' coordorigin="0,0" coordsize="'+t.width+","+t.height+'" path="m '+r[0]+","+r[1]+" l "+r.join(",")+' x e" style="zoom:1;margin:0;padding:0;display:block;position:absolute;top:0px;left:0px;width:'+t.width+"px;height:"+t.height+'px;"></v:shape>')}else if(n=="circ"){f=e('<v:oval name="'+s+'" filled="t" '+u+' style="zoom:1;margin:0;padding:0;display:block;position:absolute;left:'+(r[0]-r[2])+"px;top:"+(r[1]-r[2])+"px;width:"+r[2]*2+"px;height:"+r[2]*2+'px;"></v:oval>')}f.get(0).innerHTML=o+a;e(t).append(f)};o=function(t){var n=e("<div>"+t.innerHTML+"</div>");n.children("[name=highlighted]").remove();t.innerHTML=n.html()}}u=function(e){var t,n=e.getAttribute("coords").split(",");for(t=0;t<n.length;t++){n[t]=parseFloat(n[t])}return[e.getAttribute("shape").toLowerCase().substr(0,4),n]};h=function(t,n){var r=e(t);return e.extend({},n,e.metadata?r.metadata():false,r.data("maphilight"))};c=function(e){if(!e.complete){return false}if(typeof e.naturalWidth!="undefined"&&e.naturalWidth===0){return false}return true};a={position:"absolute",left:0,top:0,padding:0,border:0};var d=false;e.fn.maphilight=function(i){i=e.extend({},e.fn.maphilight.defaults,i);if(!n&&!d){e(window).ready(function(){document.namespaces.add("v","urn:schemas-microsoft-com:vml");var t=document.createStyleSheet();var n=["shape","rect","oval","circ","fill","stroke","imagedata","group","textbox"];e.each(n,function(){t.addRule("v\\:"+this,"behavior: url(#default#VML); antialias:true")})});d=true}return this.each(function(){var f,l,p,d,v,m,g,y,b;f=e(this);if(!c(this)){return window.setTimeout(function(){f.maphilight(i)},200)}p=e.extend({},i,e.metadata?f.metadata():false,f.data("maphilight"));b=f.get(0).getAttribute("usemap");if(!b){return}d=e('map[name="'+b.substr(1)+'"]');if(!(f.is('img,input[type="image"]')&&b&&d.size()>0)){return}if(f.hasClass("maphilighted")){var w=f.parent();f.insertBefore(w);w.remove();e(d).unbind(".maphilight").find("area[coords]").unbind(".maphilight")}l=e("<div></div>").css({display:"block",background:'url("'+this.src+'")',position:"relative",padding:0,width:this.width,height:this.height});if(p.wrapClass){if(p.wrapClass===true){l.addClass(e(this).attr("class"))}else{l.addClass(p.wrapClass)}}f.before(l).css("opacity",0).css(a).remove();if(t){f.css("filter","Alpha(opacity=0)")}l.append(f);v=r(this);e(v).css(a);v.height=this.height;v.width=this.width;g=function(t){var r,i;i=h(this,p);if(!i.neverOn&&!i.alwaysOn){r=u(this);s(v,r[0],r[1],i,"highlighted");if(i.groupBy){var o;if(/^[a-zA-Z][\-a-zA-Z]+$/.test(i.groupBy)){o=d.find("area["+i.groupBy+'="'+e(this).attr(i.groupBy)+'"]')}else{o=d.find(i.groupBy)}var a=this;o.each(function(){if(this!=a){var e=h(this,p);if(!e.neverOn&&!e.alwaysOn){var t=u(this);s(v,t[0],t[1],e,"highlighted")}}})}if(!n){e(v).append("<v:rect></v:rect>")}}};e(d).bind("alwaysOn.maphilight",function(){if(m){o(m)}if(!n){e(v).empty()}e(d).find("area[coords]").each(function(){var t,i;i=h(this,p);if(i.alwaysOn){if(!m&&n){m=r(f[0]);e(m).css(a);m.width=f[0].width;m.height=f[0].height;f.before(m)}i.fade=i.alwaysOnFade;t=u(this);if(n){s(m,t[0],t[1],i,"")}else{s(v,t[0],t[1],i,"")}}})});e(d).trigger("alwaysOn.maphilight").find("area[coords]").bind("mouseover.maphilight",g).bind("mouseout.maphilight",function(e){o(v)});f.before(v);f.addClass("maphilighted")})};e.fn.maphilight.defaults={fill:true,fillColor:"000000",fillOpacity:.2,stroke:true,strokeColor:"ff0000",strokeOpacity:1,strokeWidth:1,fade:true,alwaysOn:false,neverOn:false,groupBy:false,wrapClass:true,shadow:false,shadowX:0,shadowY:0,shadowRadius:6,shadowColor:"000000",shadowOpacity:.8,shadowPosition:"outside",shadowFrom:false}})(jQuery)